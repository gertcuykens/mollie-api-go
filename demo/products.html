

<dom-module id="forward-button" icon="arrow-forward" attributes="items activePage" on-tap="{{toggle}}" extends="core-icon-button">
  <script>
    Polymer({
        is:'forward-button',
        toggle: function() {
            var p=parseInt(this.activePage)
            p = (p+1) % this.items.length
            //this.namePage = this.items[p].album
            location.hash = '#!/1/'+p
        }
    });
  </script>
</dom-module>

<dom-module id="back-button" icon="arrow-back" attributes="items activePage" on-tap="{{toggle}}" extends="core-icon-button">
  <script>
    Polymer({
        is:'back-button',
        toggle: function() {
            var p=parseInt(this.activePage)
            if (p==0) p = this.items.length
            p = p-1
            //this.namePage= this.items[p].album
            location.hash = '#!/1/'+p
        }
    });
  </script>
</dom-module>

<dom-module id="my-products" attributes="activePage muts page namePage items added cart">

    <template>

        <style shim-shadowdom>

            :unresolved {
                display: flex;
                justify-content: flex-start;
                background: rgba(255,255,255,0.5);
                border: 1px dashed #ccc;
                border-radius: 5px;
                box-sizing: border-box;
            }

            :unresolved:after {
                padding: 15px;
                content: 'loading...';
                color: #ccc;
            }

            section {padding-top:5px;}

            .chip {
                border-radius: 3px;
                text-align: left;
                background-color: #fff;
                box-sizing: border-box;
                width:300px;
                margin: 0 2px 15px 2px;
            }

            .chip core-image:hover {box-shadow: 0 2px 10px 0 rgba(0, 0, 0, 1);}

            .card {
                height: 400px;
                border-radius: 3px;
                text-align: left;
                background: #fff;
            }

            .card-left {height:400px; width: 300px;}

            .card-right {height:400px; width: 320px;}

            .add {
                color: #FFF;
                background: #38D3D8;
            }

            .done {
                color: #FFF;
                background: rgb(37, 155, 36);
            }

        </style>

        <core-media-query query="max-width: 640px" queryMatches="{{phoneScreen}}"></core-media-query>

        <template if="{{phoneScreen}}" repeat="{{items as item}}">
           <section fit layout horizontal center center-justified style="min-height:507px" hidden?="{{item | hide(activePage)}}">
                <div class="chip">
                    <div relative style="height:400px" on-tap="{{transition}}">
                        <core-image hidden?="{{detail}}" id="m{{item.id}}" src="{{item.bg}}" sizing="contain" style="width:300px; height:400px;"></core-image>
                        <div layout vertical hidden?="{{!detail}}" style="padding:10px">
                            <h1>{{item.album}}</h1>
                            <span>{{item.artist}}</span>
                            <br/>
                            <span>Description: {{item.description}}</span>
                        </div>
                    </div>
                    <div relative style="text-align:right;" data-id="{{item.id}}"  data-price="{{item.price}}" data-qty="{{cart[item.id]}}" data-description="{{item.description}}">
                        <span style="position:absolute; top:10px; left:10px;" on-tap="{{transition}}"><core-icon icon="hardware:keyboard-arrow-up" style="margin-right:5px"></core-icon>show details</span>
                        <a href="{{item.link}}" style="position:absolute; top:35px; left:10px;"><core-icon icon="link" style="margin-right:5px"></core-icon>more pictures</a>
                        <span hidden?="{{!cart[item.id] || cart[item.id]==1}}">{{cart[item.id]}}x </span>
                        <span on-tap="{{remove}}">{{item.price}}&#8364;</span>
                        <paper-fab self-end class="{{ {add: !cart[item.id], done: cart[item.id] > 0} | tokenList }}" icon="{{ {add: !cart[item.id], done: cart[item.id] > 0} | tokenList }}" on-tap="{{add}}" style="margin:10px 10px 0 0;"></paper-fab>
                        <back-button items="{{items}}" activePage="{{activePage}}" style="position:absolute; top:10px; right:110px;"></back-button>
                        <forward-button items="{{items}}" activePage="{{activePage}}" style="position:absolute; top:10px; right:70px;"></forward-button>
                    </div>
                </div>
            </section>
        </template>

        <template if="{{!phoneScreen}}" repeat="{{items as item}}">
            <section fit layout vertical center center-justified hidden?="{{item | hide(activePage)}}">
                <div class="card" layout horizontal>
                    <div relative class="card-left">
                        <core-image src="{{item.bg}}" sizing="contain" style="width:300px; height:400px;"></core-image>
                    </div>
                    <div class="card-right" layout vertical>
                        <div flex layout vertical style="margin-left:20px;">
                            <h1>{{item.album}}</h1>
                            <span>{{item.artist}}</span>
                            <br/>
                            <!--template repeat="{{item.color as color}}">
                                <span>Color: {{color}}</span>
                            </template-->
                            <span>Description: {{item.description}}</span>
                            <br/>
                            <a href="{{item.link}}"><core-icon icon="link" style="margin-right:5px"></core-icon>more pictures</a>
                        </div>
                        <div relative style="text-align:right; height:100px" data-id="{{item.id}}"  data-price="{{item.price}}" data-qty="{{cart[item.id]}}" data-description="{{item.description}}">
                            <span hidden?="{{!cart[item.id] || cart[item.id]==1}}">{{cart[item.id]}}x </span>
                            <span on-tap="{{remove}}">{{item.price}}&#8364;</span>
                            <paper-fab self-end class="{{ {add: !cart[item.id], done: cart[item.id] > 0} | tokenList }}" icon="{{ {add: !cart[item.id], done: cart[item.id] > 0} | tokenList }}" on-tap="{{add}}" style="margin-top:40px;"></paper-fab>
                            <back-button items="{{items}}" activePage="{{activePage}}" style="position:absolute; top:40px; right:100px;"></back-button>
                            <forward-button items="{{items}}" activePage="{{activePage}}" style="position:absolute; top:40px; right:60px;"></forward-button>
                        </div>
                    </div>
                </div>
            </section>
        </template>

    </template>

    <script>
        Polymer({
            is:'my-products',
            detail:false,

            hide: function(x){
                if(x.id==this.activePage) return false;
                return true
            },

            submit: function(e) {
                document.querySelector('my-form').submit()
            },

            transition: function(e) {
                //console.log(e.target.templateInstance)
                if (e.target.localName === 'paper-fab') {return 0}
                if (e.target.localName === 'forward-button') {return 0}
                if (e.target.localName === 'back-button') {return 0}
                this.detail=!this.detail
            },

            add: function(e){
                var d = e.target.parentNode.dataset
                if(!d.qty) d.qty=0
                d.qty = parseInt(d.qty)+1
                this.cart[d.id] = d.qty
                this.added = !this.added //UGLY
            },

            remove: function(e){
                var d = e.target.parentNode.dataset
                if (d.qty > 0) d.qty = parseInt(d.qty)-1
                this.cart[d.id] = d.qty
                if (d.qty == 0) {delete this.cart[d.id]} //e.target.parentNode.removeChild(e.target)
                this.added = !this.added
            }

        });

    </script>

</dom-module>
